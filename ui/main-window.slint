import { GameWindow, TileData } from "app-window.slint";

export enum Page {
    home,
    game,
}



component HomePage inherits Rectangle {
    callback start_game();
    callback open_github();

    background: #f7f4ed;

    Rectangle {
        width: 100%;
        height: 100%;

        // 头像区域 (右上角)
        Rectangle {
            x: parent.width - 155px;
            y: 20px;
            width: 125px;
            height: 125px;
            clip: true;
            border-radius: 62.5px;
            background: white;

            Image {
                source: @image-url("icons/a.jpg");
                width: 125px;
                height: 125px;
            }
        }

        // 介绍文字区域 (左侧，头像下方)
        Rectangle {
            x: 40px;
            y: 180px;
            width: parent.width - 120px;
            height: 280px;

            VerticalLayout {
                padding: 0px;
                spacing: 6px;

                Text {
                    text: "Hi, folks, I'm Chaolun.";
                    font-size: 18px;
                    color: #000000;
                    horizontal-alignment: left;
                    wrap: word-wrap;
                    letter-spacing: 0.8px;
                }

                Text {
                    text: "I live in Shenzhen and work as a Software Engineer. I have experience in Rust, Go, and Node.js.";
                    font-size: 18px;
                    color: #000000;
                    horizontal-alignment: left;
                    wrap: word-wrap;
                    letter-spacing: 0.8px;
                }

                Text {
                    text: "I’m focused on backend architecture and system design, and I’m always open to interesting projects and collaborations.";
                    font-size: 18px;
                    color: #000000;
                    horizontal-alignment: left;
                    wrap: word-wrap;
                    letter-spacing: 0.8px;
                }
            }
        }

        // 社交图标区域 (右下角)
        Rectangle {
            x: parent.width - 120px;
            y: parent.height - 50px;
            width: 120px;
            height: 40px;

            // GitHub 图标
            Rectangle {
                x: 0;
                y: 0;
                width: 40px;
                height: 40px;
                background: transparent;

                Image {
                    source: @image-url("icons/github.svg");
                    width: 25px;
                    height: 25px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.open_github();
                    }
                }
            }

            // Game 图标
            Rectangle {
                x: 60px;
                y: 0;
                width: 45px;
                height: 45px;
                background: transparent;

                Image {
                    source: @image-url("icons/game.svg");
                    width: 45px;
                    height: 45px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.start_game();
                    }
                }
            }
        }
    }
}

export component MainWindow inherits Window {
    preferred-width: 400px;
    preferred-height: 600px;
    min-width: 320px;
    min-height: 500px;
    title: "Always Blue - Ocean World";

    in-out property <Page> current_page: Page.home;

    // 游戏相关的属性和回调
    callback check_if_pair_solved();
    in property <bool> disable_tiles;
    in-out property <[TileData]> memory_tiles;
    in-out property <bool> game_completed: false;

    if current_page == Page.home: HomePage {
        start_game => {
            root.current_page = Page.game;
            root.start_game_session();
        }
        open_github => {
            // 在网页环境中打开 GitHub 链接
            // 这个回调将在 Rust 代码中处理
            root.open_github_page();
        }
    }

    if current_page == Page.game: GameWindow {
        width: root.width;
        height: root.height;
        disable_tiles: root.disable_tiles;
        memory_tiles: root.memory_tiles;

        check_if_pair_solved => {
            root.check_if_pair_solved();
        }

        play_match_sound => {
            root.play_match_sound();
        }

        // 添加返回按钮
        Rectangle {
            x: 10px;
            y: 10px;
            width: 80px;
            height: 35px;
            background: #34495E;
            border-radius: 5px;
            z: 1000;

            Text {
                text: "← Back";
                color: white;
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            TouchArea {
                clicked => {
                    root.current_page = Page.home;
                    root.stop_background_music();
                    root.game_completed = false;
                }
            }
        }
    }

    // 胜利庆祝界面
    if current_page == Page.game && game_completed: Rectangle {
        width: 100%;
        height: 100%;
        background: #00000088;

        // 阻止点击穿透到游戏区域
        TouchArea {}

        Rectangle {
            width: min(root.width * 0.8, 300px);
            height: 220px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: white;
            border-radius: 16px;
            drop-shadow-blur: 20px;
            drop-shadow-color: #00000040;

            VerticalLayout {
                alignment: center;
                spacing: 12px;
                padding: 24px;

                Text {
                    text: "Congratulations!";
                    font-size: 22px;
                    color: #2c3e50;
                    horizontal-alignment: center;
                    font-weight: 700;
                }

                Text {
                    text: "You matched all pairs!";
                    font-size: 15px;
                    color: #7f8c8d;
                    horizontal-alignment: center;
                }

                HorizontalLayout {
                    alignment: center;
                    spacing: 12px;
                    padding-top: 8px;

                    Rectangle {
                        width: 110px;
                        height: 38px;
                        background: #3960D5;
                        border-radius: 8px;

                        Text {
                            text: "Play Again";
                            color: white;
                            font-size: 14px;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        TouchArea {
                            clicked => {
                                root.start_game_session();
                            }
                        }
                    }

                    Rectangle {
                        width: 110px;
                        height: 38px;
                        background: #34495E;
                        border-radius: 8px;

                        Text {
                            text: "← Home";
                            color: white;
                            font-size: 14px;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        TouchArea {
                            clicked => {
                                root.current_page = Page.home;
                                root.stop_background_music();
                                root.game_completed = false;
                            }
                        }
                    }
                }
            }
        }
    }

    // GitHub 页面打开回调
    callback open_github_page();

    // 游戏与音频回调
    callback start_game_session();
    callback stop_background_music();
    callback play_match_sound();
}
